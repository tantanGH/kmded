# KMDED.X
KMD Track Editor for X680x0/Human68k

KMD歌詞データ編集に特化したステップ入力式のシーケンサ風エディタです。

KMDデータはSMR.X作者のYas氏により考案されたフォーマットで、以下のプログラムでPCM曲再生時にタイミングを合わせた歌詞表示に利用できます。

* SMR.X (1997年最終版)
* [MP3EXP.X](https://github.com/tantanGH/mp3exp)


<img src='images/kmded1.png' width='800'/>

---

### インストール方法

KMDEDxxx.ZIP をダウンロードして展開し、KMDED.X をパスの通ったディレクトリに置きます。

KMDED.X を動作させるには phillyさんの PCM8A.X が必要になります。PCM8Aの拡張機能を利用しているため、バージョン1.02以上を導入してください。X68000 LIBRARY からダウンロードできます。

[PCM8A.X](http://retropc.net/x68000/software/sound/adpcm/pcm8a/)


注意：オリジナルのPCM8.Xでは動作しません。PCM8PP.Xには対応していません。

注意：開発およびエミュレータ・実機での動作確認は X68030 25MHz を念頭においています。低クロック機では期待通りに動作しない可能性があります。

---

### 割り込みに関して

KMDED.X はできるだけタイミングを厳密に取るために、Timer-A/D の割り込みを両方とも使用します。これらの割り込みを使う常駐プログラムなどと一緒に動作させることはできません。

また、Timer-Dを使うHuman68k のバックグラウンド機能も利用できません。CONFIG.SYS で PROCESS= の行が有効になっている場合は、本プログラム利用時はコメントアウトする必要があります。

---

### 起動方法

    kmded <KMDファイル名>

コマンドラインで編集対象となるKMDファイル名を指定して起動します。ファイルが存在しない場合には新規で作成するか聞いてきます。

また、KMDファイルと同じ主ファイル名で以下の形式のPCMデータがあれば、それを読み込んで実際に音を聴きながら編集作業を行うことができます。

- .pcm (X68k MSM6258V ADPCM 15.625kHz mono)
- .m32/.m44/.m48 (16bit signed PCM mono)
- .s32/.s44/.s48 (16bit signed PCM stereo)

いずれの形式であっても、8bit 15.625kHz mono PCMデータに変換してメモリ上に抱えますので、読み込み負担の小さい .pcm か .m32 形式に NOZさんの PCM3PCM.X などで事前に変換しておくのをお勧めします。

---

### 画面構成

画面は以下のように8つのエリアがあります。

<img src='images/kmded2.png' width='800'/>

1. バージョン表示

バグ修正や改良されたバージョンを短期間でリリースする可能性がありますので、常に最新版を使うようにお願いします。

2. ファンクションキー機能表示

F1 ~ F10 の各ファンクションキーに割り当てられた機能一覧です。

3. PCM再生モード時の情報表示

PCM再生モード(後述)で補足情報が表示されます。

4. ファイル名・タグ情報表示

KMDEDはKMDファイルの最後に確実に再生されないであろう時間設定にてタグ情報(曲名・アーティスト名・アルバム名)を埋め込むことができます。あくまでKMDフォーマットの枠内で歌詞の一部として埋め込まれますので、SMR.Xでも再生エラーになることはありません。MP3EXP.Xではこのタグ情報を表示することが可能です。

5. KMDイベントリスト

KMDED.X では KMDファイル内の各行のことを「イベント」と呼んでいます。

6. PCM波形表示

PCMデータを読み込んだ場合は波形が表示されます。4000msec(4秒)ごとに点線で仕切りと時間が表示されます。F3キー(RANGE)を押すと4秒仕切りを維持したまま、縮尺を変えて表示することができます。F4キー(GAIN)を押すと波形の高さを変更することができます。実際の再生時の音量にも反映されます。

7. 歌詞表示エリア

SMR.X の仕様に従い、24x24フォントを使い、12ドットずつずれた縦3段指定になります。真ん中の段は上下段と12ドットずつ重なりますので、同時に表示できるのは2段までとなります。

---

### 操作方法(基本モード)

---

### 操作方法(イベント編集モード)

---

### 操作方法(タグ編集モード)

---

### 操作方法(再生モード)

<img src='images/kmded5.gif' width='800'/>

---

### Special Thanks

* KMDデータ資料およびサンプルデータ提供 thanks to かきうちさん
* xdev68k thanks to ファミべのよっしんさん
* HAS060.X on run68mac thanks to YuNKさん / M.Kamadaさん / GOROmanさん
* HLK301.X on run68mac thanks to SALTさん / GOROmanさん
* XEiJ thanks to M.Kamadaさん
* XM6 TypeG thanks to PI.さん / GIMONSさん
* PCM8A.X thanks to phillyさん

---

### History

* 0.2.0 (2023/03/11) ... 初版
